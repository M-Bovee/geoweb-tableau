<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- <meta http-equiv="Content-Security-Policy" content="frame-src 'self' https://*.gisict.nl https://*.obsurv.nl"> -->

    <!-- Importing the Tableau Embedding API Library. -->
    <!-- Version 3.0.0 is the version corrosponding to Tableau 2021.4 which is used by Sweco -->
    <!-- <script type="module" src="https://dashboards.obsurv.nl/javascripts/api/tableau.embedding.3.0.0.min.js"></script> -->


    <title>Tableau GeoWeb Integratie</title>

    <style>
        html {
            box-sizing: border-box;
        }

        *,
        *:before,
        *:after {
            box-sizing: inherit;
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: row;
            overflow: hidden;
            color: #fff;
            background-color: #333;
        }

        input,
        label {
            display: block;
        }

        .parent,
        iframe {
            height: 100vh;
        }

        .parent {
            flex-shrink: 0;
            margin: 0;
            
            padding: 4px;
            overflow-y: auto;
        }

        iframe {
            flex-grow: 1;
            border: none;
        }

        div,
        hr {
            margin-top: 1rem;
        }
        .checkbox-container {
            height: 200px;
            /* Set the desired height for the div */
            width: 175px;
            overflow-y: scroll;
            /* Enable vertical scrollbar */
        }
    </style>

</head>

<body>
    <h1>Tableau GeoWeb Integratie</h1>
    <iframe id="viewer"
        src="https://swecostudent.geowebonline.nl/vertigisstudio/web/?app=31f3c007c8d8472b9edb3d5381c4ce9c&isEmbedded=true"
        ></iframe>




        <!-- Initialization of the Tableau visualization via web component. See more properties here:
        https://help.tableau.com/current/api/embedding_api/en-us/docs/embedding_api_configure.html -->
        <!-- <tableau-viz id="tableauViz"
            src="https://dashboards.obsurv.nl/views/PNH_OV-knooppunten_Dashboard_Test/2_Overzicht-ovk" toolbar="bottom"
            hide-tabs>
        </tableau-viz> -->
    
        <script type='text/javascript' src='https://dashboards.obsurv.nl/javascripts/api/viz_v1.js'></script>
        <div class='tableauPlaceholder' style='width: 1400px; height: 877px;'>
        <object class='tableauViz' width='1400' height='877' style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fdashboards.obsurv.nl%2F' /> 
            <param name='embed_code_version' value='3' /> 
            <param name='site_root' value='' />
            <param name='name' value='PNH_OV-knooppunten_Dashboard_Test&#47;2_Overzicht-ovk' />
            <param name='tabs' value='no' />
            <param name='toolbar' value='yes' />
            <param name='showAppBanner' value='false' />
        </object>
    </div>

    <div class="parent">
        <h2>Naam</h2>
    <div class="checkbox-container" , id="checkbox-container">
        <!-- Checkboxes will be dynamically added here -->
    </div>

    <div class="confirm_btn"></div>
    <button onclick="checkboxPostMessage()">Filter toepassen</button>

    </div>


    <script>

createCheckboxes()


function createCheckboxes() {
    const checkboxContainer = document.getElementById('checkbox-container');

    // List of items to populate checkboxes
    const itemList = ['(All)', 'Alkmaar', 'Amstelveen', 'Amsterdam', 'Beverwijk', 'Bloemendaal', 'Castricum', 'Den Helder', 'Diemen', 'Dijk en Waard', 'Drechterland', 'Enkhuizen', 'Gooise Meren',
        'Haarlem', 'Haarlemmermeer', 'Heemskerk', 'Heemstede', 'Heilo', 'Hilversum', 'Hollands Kroon', 'Hoorn', 'Koggenland', 'Landsmeer', 'Opmeer', 'Ouder-Amstel', 'Purmerend', 'Schagen', 'Stede Broec', 'Uitgeest', 'Velsen', 'Wormerland', 'Zaanstad', 'Zandvoort'];

    // Loop through the item list and create checkboxes
    itemList.forEach(function (item) {
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.name = item;
        checkbox.value = item;
        checkbox.checked = true;

        const label = document.createElement('label');
        label.textContent = item;

        checkboxContainer.appendChild(checkbox);
        checkboxContainer.appendChild(label);
    });

    // Get the checkbox with the name "(All)"
    const allCheckbox = document.querySelector('input[name="(All)"]');

    // Get all checkboxes in the class "checklist"
    const checkboxes = document.querySelectorAll('.checkbox-container input[type="checkbox"]');

    // Add an event listener to the "(All)" checkbox
    allCheckbox.addEventListener('change', function () {
        // Check or uncheck all checkboxes based on the "(All)" checkbox's state
        checkboxes.forEach(function (checkbox) {
            checkbox.checked = allCheckbox.checked;
        });
    });

}

function getCheckedCheckboxes() {
    const dataList = Array.from(document.querySelectorAll('input[type=checkbox]:checked'))
  .map(e => e.value)
  // Exclude "(All)" from array since this is not an actual value for names
  .filter(value => value !== "(All)");

console.log(typeof(dataList));
return dataList;
}

function checkboxPostMessage() {
    console.log("testPostMessage web API activit");
    const viewer = document.getElementById("viewer");
    const data = toString(getCheckedCheckboxes())
                viewer.contentWindow.postMessage(
        {type: "checkbox", filter_values: data

    }, "*");
}

        // console.log("Functie niet aangeroepen")
        // window.onload = setTimeout(testPostMessage, 10000)

        // function testPostMessage() {
        //     console.log("testPostMessage web API activit");
        //     const viewer = document.getElementById("viewer");

        //     viewer.contentWindow.postMessage(
        //         {
        //             type: "nav", layout_id: "Wonen-gemeente-c30ee6c6-ac7a-4c60-ab44-34d7c584dedf"

        //         }, "*");
        // }
        // function switchLayout() {
        //     const iframe = document.getElementById("viewer");
        //     console.log("switchLayout")
        //     iframe.contentWindow.postMessage(
        //         {
        //             id: "vertigis-web",
        //             type: "run-command",

        //             arguments: [
        //                 {
        //                     name: "workflow.run",
        //                     arguments: {
        //                         id: "c79256d0-fe28-49a8-bc74-31a6fe78497f"
        //                     }
        //                 }
        //             ]   
        //         },
        //         // WARNING: It's critical to specify an explicit target
        //         // origin instead of "*" to avoid sending messages to a
        //         // malicious origin. See
        //         // https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage.
        //         "*"
        //     );


        // }

        function switchLayout() {
            const iframe = document.getElementById("viewer");
            console.log("switchLayout")
            iframe.contentWindow.postMessage(
                {
                    id: "vertigis-web",
                    type: "run-command",
                    name: "viewer.load-layout",
                    arguments: "item://layout/Wonen-gemeente-c30ee6c6-ac7a-4c60-ab44-34d7c584dedf"

                },
                // WARNING: It's critical to specify an explicit target
                // origin instead of "*" to avoid sending messages to a
                // malicious origin. See
                // https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage.
                "*"
            );


        }

        function testPostMessage() {
            console.log("testPostMessage web API activit");
            parent.frames[0].postMessage(
                {
                    type: "nav", layout_id: "Wonen-gemeente-c30ee6c6-ac7a-4c60-ab44-34d7c584dedf"

                }, "*");
        }



        function turnLayerOff() {
            const iframe = document.getElementById("viewer");
            console.log("turnLayerOff")
            iframe.contentWindow.postMessage(
                {
                    id: "vertigis-web",
                    type: "run-command",
                    name: "layers.set-visibility",
                    arguments: {
                        layers: [
                            "91bffc7c-f991-4be7-bde7-789de22a7bcd",
                            "348beee6-d0d3-44af-b13b-96011d571f71",
                            "f0268896-be53-4cf7-adc7-9cd4f56f04e1",
                            "5d83a3dc-1407-4d89-aa6d-60ad6dd06f1a",
                            "651c8820-2b3a-4f55-b935-33e2e2947bd6"
                        ],
                        visible: false

                    },
                },
                // WARNING: It's critical to specify an explicit target
                // origin instead of "*" to avoid sending messages to a
                // malicious origin. See
                // https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage.
                "*"
            );


        }


        function zoomToInitialViewpoint() {
            // parent.frames[0] is the same as document.getElementById("viewer").contentWindow.postMessage() without having to reference a ElementById
            parent.frames[0].postMessage(
                {
                    id: "vertigis-web",
                    type: "run-command",
                    // Meerdere commands uitvoeren door ze in een list te zetten en mee te geven aan arguments, zie hieronder
                    arguments: [
                        {
                            name: "map.zoom-to-initial-viewpoint",
                        },

                        {
                            name: "ui.alert",
                            arguments: {
                                title: "Alert",
                                message: "zoomToInitialViewpoint is aangeroepen",
                                buttonText: "Ok",
                                isDraggable: true,
                                initialPosition: "center"
                            }
                        }
                    ]
                },
                // WARNING: It's critical to specify an explicit target
                // origin instead of "*" to avoid sending messages to a
                // malicious origin. See
                // https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage.
                "*"
            );
        }

        // postMessage up to this parent page.
        window.addEventListener(
            "message",
            (event) => {
                // TODO: Ensure this is a trusted domain in a real implementation
                console.log("Received a message from Web", event.data);
                const viewer = document.getElementById("viewer");
                viewer.contentWindow.postMessage(
                    {
                        type: "nav", layout_id: "Wonen-gemeente-c30ee6c6-ac7a-4c60-ab44-34d7c584dedf"

                    }, "*");
            }
        );

    </script>
</body>

</html>